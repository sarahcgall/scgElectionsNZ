---
title: "Vote Type"
---
```{=html}
<style>
  .content p {
    margin-top: 30px !important;
  }

  details {
    margin-bottom: 40px;
  }
</style>
```
```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>",
  eval = TRUE
)
```
<br>
This article provides an in-depth exploration of the [`vote_type`](https://sarahcgall.github.io/scgElectionsNZ/reference/vote_type.html) dataset, a key component of the [`scgElectionsNZ`](https://sarahcgall.github.io/scgElectionsNZ/) package, which delves into the intricacies of voting patterns in New Zealand's elections.
<br>

```{r setup, include = FALSE}
library(scgElectionsNZ)
library(dplyr)
library(ggplot2)
```
### Vote Type
The [`vote_type`](https://sarahcgall.github.io/scgElectionsNZ/reference/vote_type.html) dataset captures the complexities of the New Zealand electoral process by categorising votes based on their validity (Disallowed, Informal, Valid) and method (Ordinary, Special - NZ, Special - Overseas), across electorates and ballot types (Candidate and Party).
<br>
<br>

#### Loading and Exploring the Data
Begin by loading the [`vote_type`](https://sarahcgall.github.io/scgElectionsNZ/reference/vote_type.html) dataset and examining its structure:
```{r vote-type}
df <- scgUtils::get_data("vote_type")
head(df)
```
<br>

**Analysing Disallowed Votes**<br>
Gain insights into the percentage of disallowed votes by electorate and ballot type for the 2023 election:
```{r vote-type1}
df %>%
  filter(Election == 2023) %>%
  group_by(Ballot, Electorate, Validity) %>%
  summarise(Votes = sum(Votes), .groups = 'drop') %>%
  ungroup() %>%
  group_by(Ballot, Electorate) %>%
  mutate(Percentage = Votes / sum(Votes) * 100) %>%
  ungroup() %>%
  filter(Validity == "Disallowed") %>%
  arrange(-Percentage) %>%
  head(n = 10)
```
<br>

**Understanding Overseas Voting**<br>
Examine the proportion of overseas votes by electorate, focusing on the valid and informal votes:
```{r vote-type2}
df %>%
  # including only valid and informal votes
  filter(Election == 2023, Validity != "Disallowed") %>%
  group_by(Ballot, Electorate, Method) %>%
  summarise(Votes = sum(Votes), .groups = 'drop') %>%
  ungroup() %>%
  group_by(Ballot, Electorate) %>%
  mutate(Percentage = Votes / sum(Votes) * 100) %>%
  ungroup() %>%
  filter(Method == "Special - Overseas") %>%
  arrange(-Percentage) %>%
  head(n = 10)
```
<br>

#### Augmenting Data with Regional Information
Enhance the dataset by adding regional data for more a detailed analysis using the [`add_data`](https://sarahcgall.github.io/scgElectionsNZ/reference/add_data.html) function:
```{r vote-type3}
df <- add_data(df, output = "region")
head(df)
```
<br>

#### Visualising Overseas Votes
Create a visualisation to illustrate the proportion of overseas special Party Votes by region over time:
```{r vote-type4, dpi=300, out.width = '100%'}
df <- df %>%
  # including only valid and informal votes
  filter(Ballot == "Party", Validity != "Disallowed") %>%
  group_by(Election, Region, Method) %>%
  summarise(Votes = sum(Votes), .groups = 'drop') %>%
  ungroup() %>%
  group_by(Election, Region) %>%
  mutate(Percentage = Votes / sum(Votes) * 100) %>%
  ungroup() %>%
  filter(Method == "Special - Overseas") %>%
  arrange(-Percentage)

df %>%
  ggplot(aes(x = as.character(Election), y = Percentage, group = Region, colour = Region)) +
  geom_line() +
  geom_point() +
  gghighlight::gghighlight(use_direct_label = F) +
  facet_wrap(. ~ reorder(Region, -Percentage)) +
  scale_colour_manual(values = c("#374e8e", "#e3b13e", "#df7c18", "#ac004f",
                                 "#704600", "#1b87aa", "#478c5b"),
                      breaks = c("South Island", "Wellington / Wairarapa",
                                 "Taranaki / Whanganui / Manawatu",
                                 "Bay of Plenty / Hawke's Bay / Gisborne",
                                 "Waikato", "Auckland", "Northland")) +
  labs(title = "Proportion of Overseas Special Party Votes\nby Region over Time (1996 - 2023)",
       y = "Percentage (%)\n",
       x = "Election") +
  scgUtils::theme_scg() +
  theme(axis.text.x = element_text(angle = 45, vjust = 0.5),
        legend.position = "none")
```
```{r OverseasVotes, eval = FALSE, echo=FALSE, out.width = '100%'}
knitr::include_graphics("img/plot_OverseasVotes.png")
```
